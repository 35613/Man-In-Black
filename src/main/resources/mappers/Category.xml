<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eagle.repository.mapper.Category">
	
	<!-- <sql id="BaseCondition">
           <where>
            <choose>
                <when test="search_div == 10 ">
                 CD_ID LIKE #{search_word}
                </when>
                <when test="search_div == 20 ">
                 CD_NM LIKE #{search_word}
                </when>
                <otherwise></otherwise>                    
            </choose>
            </where>
      </sql>
	
	<resultMap id="CodMap" type="java.util.HashMap">
		<result javaType="java.lang.String" column="CD_ID" property="CD_ID"/>
		<result javaType="java.lang.String" column="CD_NM" property="CD_NM"/>
		<result javaType="java.lang.String" column="REG_ID" property="REG_ID"/>
		<result javaType="java.lang.String" column="REG_DT" property="REG_DT"/>
		<result javaType="java.lang.String" column="MOD_ID" property="MOD_ID"/>
		<result javaType="java.lang.String" column="MOD_DT" property="MOD_DT"/>
		<result javaType="java.lang.String" column="RNUM" property="RNUM"/>
		<result javaType="java.lang.String" column="TOT_CNT" property="TOT_CNT"/>
		result javaType="데이터타입" column="db컬럼명" property="맵에서 키값"/
	</resultMap> 
	
<select id="do_selectCategoryProductList" parameterType="String" resultType="CodMap">
SELECT TT1.*
FROM (
	SELECT ROWNUM RNUM,T1.*,T2.*
	FROM(

		SELECT C.SALE_CNT,C.PRO_NAME
			, C.PRO_CONTENT
			, C.PRO_SEQ
			, C.PRO_PRICE
			, C.ITEM
			, D.STORED_NAME
			, COUNT(E.PRO_SEQ) AS REVIEW_CNT
		FROM (
			SELECT COUNT(B.PRO_SEQ) AS SALE_CNT
				, A.PRO_NAME
				, A.PRO_CONTENT
				, A.PRO_SEQ
				, A.PRO_PRICE
				, A.ITEM
			FROM PRODUCT A LEFT JOIN SALES B 
			ON A.PRO_SEQ=B.PRO_SEQ 
			WHERE A.ITEM='OUTER'                       
			GROUP BY B.PRO_SEQ
				,A.PRO_NAME
				,A.PRO_CONTENT
				,A.PRO_SEQ
				,A.PRO_PRICE
				,A.ITEM
		)C LEFT JOIN PHOTO D ON C.PRO_SEQ = D.PRO_SEQ
		LEFT JOIN REVIEW E ON C.PRO_SEQ = E.PRO_SEQ
		WHERE D.STORED_NAME LIKE 'MAIN%'            
		GROUP BY C.SALE_CNT
			,C.PRO_NAME
			, C.PRO_CONTENT
			, C.PRO_SEQ
			, C.PRO_PRICE
			, C.ITEM
			, D.STORED_NAME
			, E.PRO_SEQ
		ORDER BY REVIEW_CNT DESC                    
  
	) T1 
	NATURAL JOIN(

		SELECT COUNT(*) TOT_CNT
		FROM(
			SELECT COUNT(A.PRO_SEQ)
			FROM  PRODUCT A LEFT JOIN SALES B 
			ON A.PRO_SEQ=B.PRO_SEQ 
			WHERE A.ITEM='OUTER'                       
			GROUP BY A.PRO_SEQ
		) 

	) T2
) TT1
WHERE RNUM BETWEEN 1 and 9;
</select> -->
</mapper>