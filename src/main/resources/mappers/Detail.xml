<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.eagle.repository.mapper.Detail">

<select id="do_selectProductDetail" parameterType="int" resultType="com.eagle.men_in_black.model.DetailDto">
SELECT A.PHOTO_SEQ
	, A.STORED_NAME
	, B.PRO_SEQ
	, B.BODYTYPE
	, B.PRO_NAME
	, B.PRO_CONTENT
	, B.PRO_DETAIL
	, B.WASH
	, B.MATERIAL
	, B.PRO_PRICE
	, B.BODYTYPE
	, (SELECT ROUND(AVG(SCORE))
		FROM REVIEW
		WHERE PRO_SEQ=#{PRO_SEQ}
		AND NOT SCORE IS NULL
		) AS AVG_SCORE
FROM PHOTO A INNER JOIN PRODUCT B
ON A.PRO_SEQ = B.PRO_SEQ
WHERE B.PRO_SEQ=#{PRO_SEQ}
</select>

<select id="do_selectProductColor" parameterType="int" resultType="com.eagle.men_in_black.model.DetailDto">
SELECT DISTINCT COLOR
FROM PRO_DETAIL
WHERE PRO_SEQ=#{PRO_SEQ}
</select>

<select id="do_selectProductSize" parameterType="int" resultType="com.eagle.men_in_black.model.DetailDto">
SELECT DISTINCT PRO_SIZE
FROM PRO_DETAIL
WHERE PRO_SEQ=#{PRO_SEQ}
</select>

<select id="do_selectProductReviewList" parameterType="int" resultType="com.eagle.men_in_black.model.DetailDto">
SELECT A.REV_SEQ
	, A.USER_ID
	, A.REV_TIME
	, A.REV_TITLE
	, A.SCORE
	, (SELECT ROUND(AVG(SCORE))
  		FROM REVIEW
  		WHERE PRO_SEQ=1
		) AS AVG_SCORE
	, B.STORED_NAME
FROM REVIEW A LEFT JOIN PHOTO B
ON A.REV_SEQ = B.REV_SEQ
WHERE A.PRO_SEQ=#{PRO_SEQ}
ORDER BY A.REV_REF DESC, A.REV_SEQ ASC
</select>

<select id="do_selectReviewDetail" parameterType="int" resultType="com.eagle.men_in_black.model.DetailDto">
SELECT *
FROM REVIEW
WHERE REV_SEQ=#{REV_SEQ}
</select>

</mapper>